<script>

    function ifAccessDo(callback) {
        const access_token = localStorage.getItem('token');
        if (typeof access_token === 'undefined') { 
            window.location.href = "/"; 
        }
        else {
            // let domain = (new URL(window.location));
            // const prebsjnk = domain.origin;
            // let furl = prebsjnk + '/users/me';
            let furl = '/users/me';
            //
            const options = { headers: { "Authorization": "Bearer " + access_token } }
            fetch(furl, options )
            .then(response => response.json())
            .then( response =>  {

                if (!response.hasOwnProperty('username')) {
                   window.location.href = "/";
                }
                else {
                    if (typeof callback == "function")
                        callback();
                }
            })
			.catch(err => {
				// Do something with the error
				console.log(err) 
				// alert( err )
				// crtMsg.innerHTML = 'Problem: ' + err;
			});
        }
    }
    
    function ifAccessDoWithUser(callback) {
        const access_token = localStorage.getItem('token');
        if (typeof access_token === 'undefined') { 
            window.location.href = "/"; 
        }
        else {
            // let domain = (new URL(window.location));
            // const prebsjnk = domain.origin;
            // let furl = prebsjnk + '/users/me';
            let furl = '/users/me';
            //
            const options = { headers: { "Authorization": "Bearer " + access_token } }
            fetch( furl, options )
            .then(response => response.json())
            .then( response =>  {

                if (!response.hasOwnProperty('username')) {
                   window.location.href = "/";
                }
                else {
                    if (typeof callback == "function")
                        callback(response);
                }
            })
			.catch(err => {
				// Do something with the error
				console.log(err) 
				// alert( err )
				// crtMsg.innerHTML = 'Problem: ' + err;
			});
        }
    }
</script>